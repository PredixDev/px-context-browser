<link rel="import" href="../polymer/polymer.html"/>

<link rel="import" href="px-app-behavior-asset-graph.html"/>
<link rel="import" href="px-app-behavior-asset-browsable.html"/>
<link rel="import" href="px-app-behavior-asset-selectable.html"/>
<link rel="import" href="px-context-browser-panel.html"/>
<link rel="import" href="px-context-browser-header.html"/>
<link rel="import" href="px-context-browser-list.html"/>
<link rel="import" href="px-context-browser-item.html"/>

<dom-module id="px-context-browser">
  <template>
    <style>
      .column {
        display: none;
      }
      .column--active {
        display: block;
      }
    </style>

    <px-context-browser-panel>
      <!-- Header -->
      <template is="dom-if" if="[[active]]">
        <px-context-browser-header slot="header" label="[[active.label]]"></px-context-browser-header>
      </template>
      <!-- List -->
      <px-context-browser-list slot="body">
        <div slot="items">
          <template is="dom-repeat" items="[[_columns]]" as="column">
            <div class$="column {{column.classNames}}">
              <template is="dom-repeat" items="[[column.items]]" as="item">
                <px-context-browser-item label="[[item.label]]" can-favorite can-select can-open></px-context-browser-item>
              </template>
            </div>
          </template>
        </div>
      </px-context-browser-list>
    </px-context-browser-panel>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'px-context-browser',

    behaviors: [
      PxAppBehavior.AssetGraph,
      PxAppBehavior.AssetSelectable,
      PxAppBehavior.AssetBrowsable
    ],

    properties: {
      _columns: {
        type: Array,
        value: function() {
          return [];
        }
      },

      _activeColumn: {
        type: Number,
        value: 0
      }
    },

    listeners: {
      'px-app-asset-graph-created' : '_activeRootColumn'
    },

    _activeRootColumn() {
      this.splice('_columns', 0, 1, {
        index: 0,
        classNames: 'column--active',
        items: this.items
      });
      // var prevCol = this._columns[0];
      // this._columns[0] = {
      //   index: 0,
      //   name: 'foo',
      //   items: this.items
      // };
      // this.notifySplices('_columns', [{
      //   index: 0,
      //   removed: prevCol,
      //   addedCount: 1,
      //   object: this._columns,
      //   type: 'splice'
      // }]);
      // this.notifyPath('_columns.#0.name');
    }
  })
</script>
